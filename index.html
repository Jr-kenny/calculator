<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Onchain Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body {
      background: #121212;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .calculator {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0px 0px 20px rgba(0,0,0,0.5);
      width: 350px;
      text-align: center;
    }
    h1 {
      margin-bottom: 15px;
      font-size: 22px;
      color: #00ffcc;
    }
    input {
      width: 80%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 16px;
    }
    button {
      width: 70px;
      height: 50px;
      margin: 5px;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background: #00ffcc;
      color: #121212;
      transition: background 0.2s;
    }
    button:hover {
      background: #00ccaa;
    }
    #result {
      margin-top: 15px;
      font-size: 18px;
      color: #ffd700;
    }
    #connect {
      background: #ff4081;
      color: #fff;
      width: 90%;
      height: 45px;
      font-size: 16px;
      margin-top: 10px;
    }
    #connect:hover {
      background: #e73370;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <h1>Onchain Calculator</h1>
    <input type="number" id="num1" placeholder="First number"><br>
    <input type="number" id="num2" placeholder="Second number"><br>
    <div>
      <button onclick="calculate('add')">+</button>
      <button onclick="calculate('subtract')">−</button>
      <button onclick="calculate('multiply')">×</button>
      <button onclick="calculate('divide')">÷</button>
    </div>
    <button id="connect" onclick="connectWallet()">Connect Wallet</button>
    <div id="result">Result: </div>
  </div>

  <script>
    let provider, signer, contract;
    
    const contractAddress = "0x0640761a8AaF04Ef63708789189b8beD47AA338A";
    const abi = [
      "function add(uint256 a, uint256 b) public payable returns (uint256)",
      "function subtract(uint256 a, uint256 b) public payable returns (uint256)",
      "function multiply(uint256 a, uint256 b) public payable returns (uint256)",
      "function divide(uint256 a, uint256 b) public payable returns (uint256)"
    ];

    async function connectWallet() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, abi, signer);
        document.getElementById("result").innerText = "Wallet connected!";
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function calculate(operation) {
      if (!contract) {
        alert("Please connect wallet first!");
        return;
      }
      const num1 = document.getElementById("num1").value;
      const num2 = document.getElementById("num2").value;
      try {
        const tx = await contract[operation](num1, num2, { value: 0 }); 
        document.getElementById("result").innerText = "⏳ Waiting for transaction...";
        const receipt = await tx.wait();
        const event = receipt.events?.find(e => e.event === null);
        document.getElementById("result").innerText = `✅ Tx confirmed: ${tx.hash}`;
      } catch (err) {
        console.error(err);
        document.getElementById("result").innerText = "❌ Error: " + err.message;
      }
    }
  </script>
</body>
</html>
